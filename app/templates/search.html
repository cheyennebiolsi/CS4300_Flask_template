<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="/static/owlcarousel/owl.carousel.min.css">
    <link rel="stylesheet" href="/static/owlcarousel/owl.theme.default.min.css">
    <link rel="stylesheet" href="/static/mdb/css/mdb.min.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"></script>
    <link rel="stylesheet" href="/static/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>
    <script src="/static/bootstrap-tagsinput.js"></script>
    <link rel="stylesheet" href="/static/bootstrap-tagsinput.css">
    <link rel="stylesheet" href="/static/css/search.css" type="text/css">
    <link rel="stylesheet" href="/static/css/featuredisplay.css" type="text/css">
    <link rel="stylesheet" href="/static/css/featuredisplay2.css" type="text/css">
    <link rel="stylesheet" href="/static/css/recommended.css" type="text/css">
    <link rel="icon" type="image/png" sizes="96x96" href="/static/favicon-96x96.png">
    <script src="/static/typeahead.bundle.js"></script>
    <script src="/static/bloodhound.js"></script>
    <script src="/static/js/Chart.bundle.min.js"></script>
    <script src="/static/aniai.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!--        <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Maven+pro"> -->
    <script>
        $(window).on("load", function()  { 
                drawInitialChart();
                createLegend('chart-legends', anime_scores);
                    drawSimilarityCharts();
            {% if similarityData %}
                {% for d in similarityData %}
                    {% for index in [0, 1] %}
                       {% if loop.index == 1 %}
                           {% set id = "#" + d['chart_id_a'] %}
                           {% set name = d['chart_name_a'] %}
                       {% else %}
                           {% set id = "#" + d['chart_id_b'] %}
                           {% set name = d['chart_name_b'] %}
                       {% endif %}
       	            document.querySelector("{{id}}").onclick = function(evt){
	                var activePoints = {{name}}.getElementsAtEvent(evt);
			var firstPoint = activePoints[0];
			if (firstPoint !== undefined) {
			        var label = {{name}}.data.labels[firstPoint._index];
                                $('#wordinput').tagsinput('add', {word: label, sign: 'positive'});
                        };
		     };
                     {% endfor %}
                {% endfor %}
            {% endif %}
            {% if data %}
		document.querySelector("#vis").onclick = function(evt){
			var activePoints = anime_scores.getElementsAtEvent(evt);
			var firstPoint = activePoints[0];
			if (firstPoint !== undefined) {
			        var label = anime_scores.data.labels[firstPoint._index];
                                $('#wordinput').tagsinput('add', {word: label, sign: 'positive'});
                        };
		};
            {% endif %}
        });
        document.addEventListener("DOMContentLoaded", function(event) {
            initializeSearchBars();
            $("#suggestion-carousel").owlCarousel( {
                items: 4,
                loop: true,
                margin: 20,
                nav: true,
                responsive: {
                    0: {
                        items: 2
                    },
                    576: {
                        items: 3
                    },
                    768: {
                        items: 4
                    },
                    992: {
                        items: 6
                    }
                },
                navText: ['<i class="fa fa-angle-left" aria-hidden="true"></i>','<i class="fa fa-angle-right" aria-hidden="true"></i>']
            });
            //resizeSearchBar();
            {% if data %}
                {% if prevwords %}
                    var prevwords = '{{prevwords}}';
                    var words = prevwords.split('|');
                    initializeWordSearch(words);
                {% else %}
                    initializeWordSearch([]);
                {% endif %}
                {% if prevsearch %}
                    var prevwords = '{{prevsearch}}';
                    var words = prevwords.split('|');
                    initializeAnimeSearch(words);
                {% else %}
                    initializeAnimeSearch([]);
                {% endif %}
             //   resizeInfo();
              //  resizeStatistics();
                //izeesizeTags();
            {% else %}
                initializeWordSearch([]);
                initializeAnimeSearch([]);
            {% endif %}
            {% if (prevfilters2 and prevfilters2['sfw']) %}
               $('#collapsensfwrating').collapse('toggle');
               $('#collapsensfw').collapse('toggle');
            {% endif %}
            $('.fa[data-toggle="tooltip"]').tooltip();
//            $('.tt_input[data-toggle="tooltip"]').tooltip({trigger: "manual"});
        }
        );
    </script>    
</head>

<body>


    

    <style>
        .tree{
            position: fixed;
            top: 0;
            left: 0;
            width: 400px;
            height: 300px;
            padding:0;
            background: none;
            z-index: -2;
        }
    </style>

    <div class="tree">
        <img src="/static/images/csscherry3.png" style='width: 100%; '>
    </div>
    <div>
        <!--title-->
        <h1 style="padding-top:20%; font-size: 85px; font-family:Futura; color:#efe9e8; text-align:center" hidden>
            &ensp;Aniai &#24859
        </h1>
        <!--tag line-->
        <!-- <h1 style="padding-top:20%; font-size: 85px; font-family:Futura; color:white; text-align:center">Let's Find Some Good Anime</h1> -->
        <form id="myform" autocomplete="off" action = "{{ url_for('irsystem.search') }}" method='get'> <!--class = "form-inline global-search" id="myform"> -->
            <div class="row">
                <div class="col-12 col-sm-12 col-md-auto col-lg-auto align-self-center">
                    <div class="aniai" onclick="redirectHomepage()"> &ensp;Aniai &#24859 </div>
                </div>
                <div class="col-12 col-sm-12 col-md col-lg searchbars">
                <div class="form-group animeinput">
                <!-- style:"height:30px vertical-align:bottom"> -->
                    <div class="input-group-prepend">
                        <button type="button" disabled>anime<i class="fa fa-info-circle" data-toggle="tooltip" data-placement="top" data-html="true" title=""></i></button>
                    </div>
                    <input id="animeinput" class="tagsinput-typeahead" type="text" name="animesearch"/>
                    <div class="input-group-append">
                        <button type="submit" id="submit"><i class="fa fa-search"></i></button>
                    </div>
                </div> <!--class = "form-inline global-search" id="myform"> -->
                <div class="form-group wordinput"> 
                    <div class="input-group-prepend">
                        <button type="button" disabled>keywords<i class="fa fa-info-circle" data-toggle="tooltip" data-placement="bottom" data-html="true" title=""></i></button>
                    </div>
                    <input id="wordinput" class="tagsinput-typeahead" type="text" name="wordsearch"/>
                    <div class="input-group-append">
                        <button id="filter-btn" type = "button" data-toggle="collapse" data-target="#collapseForm" aria-expanded="false" aria-controls="collapseForm">
                            <i class="fa fa-filter" style="margin-right: 3px"></i>Filter
                        </button>
                    </div>
                 </div>
                 </div>
            </div>
            <div class="collapse" id="collapseForm">
                <div class="form-group row justify-content-md-around">
                    <div class="col-md-12 col-lg-6" style="text-align:center">
                        <div class="filter-header">
                            <span style="padding: 0px 30px">Allowed Anime Genres</span>
                            <label class="fancy-checkbox" style="color:white;position: absolute; right: 30px">
                                <input type="checkbox" onclick="toggle(this);" unchecked/>
                                <i class="fa fa-check-square-o unchecked" data-toggle="tooltip" data-placement="right" title="Deselect all genres?" style="font-size:30px; margin-left:10px; color:green"></i>
                                <i class="fa fa-square-o checked" data-toggle="tooltip" data-placement="right" title="Select all genres?" style="font-size:30px; margin-left:10px; padding-right:5px; color:green"></i>
                            </label>
                        </div>
                        <hr>
                        <div class="form-check">
                            
                            {% set genres=['action', 'adventure', 'cars', 'comedy', 'dementia', 'demons', 'drama','fantasy', 'game', 'harem', 'historical', 'horror', 'josei', 'kids', 'magic', 'martial arts', 'mecha', 'military', 'music', 'mystery', 'parody', 'police', 'psychological', 'romance', 'samurai', 'school', 'sci-fi', 'seinen', 'shoujo', 'shoujo-ai', 'shounen', 'shounen-ai', 'slice of life', 'space', 'sports', 'super power', 'supernatural', 'thriller', 'vampire'] %}
           
                                {% for genre in genres %}
                                    {% set genre_name = genre.replace(" ", "_") %}
                            <label class="genre-checkbox" style="color:white">
                                <input type="checkbox" name={{genre_name}} id = "sfwgenre" {% if prevfilters2 and prevfilters2[genre_name]%} checked 
                                                                                           {% elif prevfilters2 %} unchecked 
                                                                                           {% else %} unchecked {% endif%}/>
                                <div class="genre-button-inner active unchecked">{{genre}}</div>
                                <div class="genre-button-inner inactive checked">{{genre}}</div>
                            </label>
                                {% endfor %}
                            <div>
                                <div class="collapse" id="collapsensfw">
                                    <div class="form-check">
                                        {% set nsfwgenres=['ecchi', 'hentai', 'yaoi', 'yuri']%}
                                        {% for nsfwgenre in nsfwgenres %}
                                        <label class="genre-checkbox" style="color:white">
                                            <input type="checkbox" name={{nsfwgenre}} id="nsfwgenre" {% if prevfilters2 and prevfilters2[nsfwgenre]%} checked 
                                                                                                     {% elif prevfilters2 %} unchecked 
                                                                                                     {% else %} checked {% endif%}/>
                                            <div class="genre-button-inner active unchecked">
                                                {{nsfwgenre}}
                                            </div>
                                            <div class="genre-button-inner inactive checked">
                                                {{nsfwgenre}}
                                            </div>
                                        </label>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        </div> 
                    </div>

                    <div class="col-md-6 col-lg-auto">
                        <div class="filter-header">
                            <span>Type</span>
                        </div>
                        <hr>
                        <div class="d-flex flex-column justify-content-between">
                        
                        <div class="d-flex flex-row justify-content-between">
                        <div class="form-check">
                            <label class="fancy-checkbox" style="color:white">
                                <input type="checkbox" name="displayTv" {% if prevfilters2 and prevfilters2['displayTv']%} checked 
                                                                        {% elif prevfilters2 %} unchecked 
                                                                        {% else %} unchecked {% endif%}/>
                                <i class="fa fa-fw fa-times checked" style="color:red"></i>
                                <i class="fa fa-fw fa-check unchecked" style="color:green"></i>
                                television
                            </label>
                        </div>

                        <div class="form-check">
                            <label class="fancy-checkbox" style="color:white;">
                                <input type="checkbox" name="displayOva" {% if prevfilters2 and prevfilters2['displayOva']%} checked 
                                                                         {% elif prevfilters2 %} unchecked 
                                                                         {% else %} unchecked {% endif%}/>
                                <i class="fa fa-fw fa-times checked" style="color:red"></i>
                                <i class="fa fa-fw fa-check unchecked" style="color:green"></i>
                                OVA
                            </label>
                        </div>
                        </div>

                        <div class="d-flex flex-row justify-content-between">
                        <div class="form-check">
                            <label class="fancy-checkbox" style="color:white">
                                <input type="checkbox" name="displayMovie" {% if prevfilters2 and prevfilters2['displayMovie']%} checked 
                                                                           {% elif prevfilters2 %} unchecked 
                                                                           {% else %} unchecked {% endif%}/>
                                <i class="fa fa-fw fa-times checked" style="color:red"></i>
                                <i class="fa fa-fw fa-check unchecked" style="color:green"></i>
                                movie
                            </label>
                        </div>

                        <div class="form-check">
                            <label class="fancy-checkbox" style="color:white;">
                                <input type="checkbox" name="displayOna" {% if prevfilters2 and prevfilters2['displayOna']%} checked 
                                                                         {% elif prevfilters2 %} unchecked 
                                                                         {% else %} unchecked {% endif%}/>
                                <i class="fa fa-fw fa-times checked" style="color:red"></i>
                                <i class="fa fa-fw fa-check unchecked" style="color:green"></i>
                                ONA
                            </label>
                        </div>

                        </div>
                        <div class="form-check">
                            <label class="fancy-checkbox" style="color:white">
                                <input type="checkbox" name="displaySpecial" {% if prevfilters2 and prevfilters2['displaySpecial']%} checked 
                                                                             {% elif prevfilters2 %} unchecked 
                                                                             {% else %} unchecked {% endif%}/>
                                <i class="fa fa-fw fa-times checked" style="color:red"></i>
                                <i class="fa fa-fw fa-check unchecked" style="color:green"></i>
                                special
                            </label>
                        </div>
                        </div>

                        <div class="filter-header">
                            <span>How You Want To Watch</span>
                        </div>
                        <hr>
                        <div class="form-check">
                            <label class="fancy-checkbox" style="color:white">
                                <input type="checkbox" name="streamCrunchy" {% if prevfilters2 and prevfilters2['streamCrunchy']%} checked 
                                                                            {% elif prevfilters2 %} unchecked 
                                                                            {% else %} unchecked {% endif%}/>
                                <i class="fa fa-fw fa-times checked" style="color:red"></i>
                                <i class="fa fa-fw fa-check unchecked" style="color:green"></i>
                                crunchyroll
                            </label>
                        </div>

                        <div class="form-check">
                            <label class="fancy-checkbox" style="color:white">
                                <input type="checkbox" name="streamHulu" {% if prevfilters2 and prevfilters2['streamHulu']%} checked 
                                                                         {% elif prevfilters2 %} unchecked 
                                                                         {% else %} unchecked {% endif%}/>
                                <i class="fa fa-fw fa-times checked" style="color:red"></i>
                                <i class="fa fa-fw fa-check unchecked" style="color:green"></i>
                                hulu
                            </label>
                        </div>

                        <div class="form-check">
                            <label class="fancy-checkbox" style="color:white">
                                <input type="checkbox" name="streamYahoo" {% if prevfilters2 and prevfilters2['streamYahoo']%} checked 
                                                                          {% elif prevfilters2 %} unchecked 
                                                                          {% else %} unchecked {% endif%}/>
                                <i class="fa fa-fw fa-times checked" style="color:red"></i>
                                <i class="fa fa-fw fa-check unchecked" style="color:green"></i>
                                Yahoo! View
                            </label>
                        </div>

                        <div class="form-check">
                            <label class="fancy-checkbox" style="color:white">
                                <input type="checkbox" name="streamNone" {% if prevfilters2 and prevfilters2['streamNone']%} checked 
                                                                         {% elif prevfilters2 %} unchecked 
                                                                         {% else %} unchecked {% endif%}/>
                                <i class="fa fa-fw fa-times checked" style="color:red"></i>
                                <i class="fa fa-fw fa-check unchecked" style="color:green"></i>
                                allow no provider
                            </label>
                        </div>
                    </div>
                    
                    <div class="col-md-6 col-lg-auto">
                        <div class="form-check filter">
                            <div class="filter-header">
                                <span> Rated </span>
                                <label id="sfw-collapse" class="genre-checkbox" style="color:white; position:absolute; top:10px">
                                    <input type="checkbox" name="sfw" id="sfw-button" onclick="clearnsfw(this)" data-toggle="collapse" data-target="#collapsensfw, #collapsensfwrating" aria-expanded="false" aria-controls="collapsensfw" {% if prevfilters2 and prevfilters2['sfw'] %} checked {% else %} unchecked {%endif%}/>
                                    <div class="sfw-button checked">NSFW ON</div>
                                    <div class="sfw-button active unchecked">SFW ON</div>
                                </label>
                            </div>
                                <!--<input style="display:inline" type="checkbox" class="form-check-input tag" id="sfwSearch" name="sfwSearch" checked>
                                <label style="display:inline" for="sfwSearch" class="sfw-button active" data-toggle="collapse" data-target="#collapsensfw, #collapsensfwrating" aria-expanded="false" aria-controls="collapsensfw">  SFW ON  </label> -->
                            </div>
                        <!-- </div> -->
                        <hr>

                        <div class="form-check">
                            <label class="fancy-checkbox" style="color:white">
                                <input type="checkbox" name="gRating" {% if prevfilters2 and prevfilters2['gRating']%} checked 
                                                                         {% elif prevfilters2 %} unchecked 
                                                                         {% else %} unchecked {% endif%}/>
                                <i class="fa fa-fw fa-times checked" style="color:red"></i>
                                <i class="fa fa-fw fa-check unchecked" style="color:green"></i>
                                G &#8212 all ages
                            </label>
                        </div>

                        <div class="form-check">
                            <label class="fancy-checkbox" style="color:white">
                                <input type="checkbox" name="pgRating" {% if prevfilters2 and prevfilters2['pgRating']%} checked 
                                                                         {% elif prevfilters2 %} unchecked 
                                                                         {% else %} unchecked {% endif%}/>
                                <i class="fa fa-fw fa-times checked" style="color:red"></i>
                                <i class="fa fa-fw fa-check unchecked" style="color:green"></i>
                                PG &#8212 children
                            </label>
                        </div>

                        <div class="form-check">
                            <label class="fancy-checkbox" style="color:white">
                                <input type="checkbox" name="pg13Rating" {% if prevfilters2 and prevfilters2['pg13Rating']%} checked 
                                                                         {% elif prevfilters2 %} unchecked 
                                                                         {% else %} unchecked {% endif%}/>
                                <i class="fa fa-fw fa-times checked" style="color:red"></i>
                                <i class="fa fa-fw fa-check unchecked" style="color:green"></i>
                                PG-13 &#8212 teens 13 or older
                            </label>
                        </div>

                        <div class="form-check">
                        <label class="fancy-checkbox" style="color:white">
                        <input type="checkbox" name="r17Rating" {% if prevfilters2 and prevfilters2['r17Rating']%} checked 
                                                                         {% elif prevfilters2 %} unchecked 
                                                                         {% else %} unchecked {% endif%}/>
                        <i class="fa fa-fw fa-times checked" style="color:red"></i>
                        <i class="fa fa-fw fa-check unchecked" style="color:green"></i>
                        R &#8212 17+ (violence & profanity)
                        </label>
                        </div>

                        <div class="collapse" id="collapsensfwrating">
                            <div class="form-check">
                                <label class="fancy-checkbox" style="color:white">
                                <input type="checkbox" name="rPlusRating" id="nsfwrating" {% if prevfilters2 and prevfilters2['rPlusRating']%} checked 
                                                                         {% elif prevfilters2 %} unchecked 
                                                                         {% else %} checked {% endif%}/>
                                <i class="fa fa-fw fa-times checked" style="color:red"></i>
                                <i class="fa fa-fw fa-check unchecked" style="color:green"></i>
                                R+ &#8212 mild nudity
                                </label>
                            </div>
                            <div class="form-check">
                                <label class="fancy-checkbox" style="color:white">
                                <input type="checkbox" name="rxRating" id="nsfwrating" {% if prevfilters2 and prevfilters2['rxRating']%} checked 
                                                                                       {% elif prevfilters2 %} unchecked 
                                                                                       {% else %} checked {% endif%}/>
                                <i class="fa fa-fw fa-times checked" style="color:red"></i>
                                <i class="fa fa-fw fa-check unchecked" style="color:green"></i>
                                Rx &#8212 hentai
                                </label>
                            </div>
                        </div>

                        <div class="form-check filter" style="border: 2px solid white; padding-bottom: 10px; margin-top: 4px">
                            <div class="filter-header">
                                <span> Filter Same Series </span>
                                <label class="fancy-checkbox" style="color:white; position:absolute; top:10px">
                                <input type="checkbox" name="filter same series" {% if prevfilters2 and prevfilters2['filter same series']%} checked 
                                                                                 {% elif prevfilters2 %} unchecked 
                                                                                 % else %} checked {% endif%}/>                               
                                <i class="fa fa-check-square-o checked" style="font-size:30px; margin-left:10px; color:green"></i>
                                <i class="fa fa-square-o unchecked" style="font-size:30px; margin-left:10px; color:green"></i>
                                </label>
                            </div>
                        </div>
                        <br>
                    </div>
                </div>             
            </div> 
        </form>
</div>
        {% if similarityData %}
        <div class="d-flex similarity-index">
            <div class="align-self-center">Display query anime information:</div>
        {% for d in similarityData %}
       <a class="align-self-center tag label label-display collapsed" data-toggle="collapse" href="{{'#' + d['collapse_id']}}" role="button" aria-expanded="false" aria-controls="{{d['collapse_id']}}">{{d['anime_english_title']}}</a>
        {% endfor %}
        </div>
        {% for d in similarityData %}
         <div id="{{d['collapse_id']}}" class="collapse multi-collapse"}>
             {% for index in [0, 1] %}
             {% set title = d['anime_english_title']%}
             <div class={% if loop.index == 1 %} "container-fluid feature-display inverted" {% else %} "container-fluid feature-display" {% endif %} hidden>
                <div class="row feature-row">
                <div class={% if loop.index==1 %} "col-md-12 col-lg-6 order-lg-3" {% else %} "col-md-12 col-lg-6" {% endif %} style="height: 400px">
                    <div class="feature-anime-info">
                        <div class ="d-flex flex-column">
                            <div class="d-flex justify-content-between anime-info-bar">
                                <div class={% if loop.index==1 %}"align-self-start order-last" {% else%}"align-self-start" {% endif %}><i onclick="addAnime('{{title}}')" class="fa fa-plus"></i></div>
                                <div class="feature-icon align-self-end">
                                    <img src="/static/images/yahoo_view_icon.png"
                                    {% if not 'yahoo' in d['anime_video_url'] %} hidden {% endif %}>
                                    <span style="margin-top: -4px; font-family:FuturaMedium; font-weight: bold; font-size:25; color:lawngreen"
                                    {% if not 'hulu' in d['anime_video_url'] %} hidden {% endif %}>hulu</span>
                                    <img src="/static/images/Crunchyroll_24x24.png"
                                    {% if not 'crunchyroll' in d['anime_video_url'] %} hidden {% endif %}>
                                    <span style="color: darkorange; font-size: 26px; line-height: 30px; font-weight: 600; margin-top: -3px; margin-left: 4px" 
                                    {%if not 'crunchyroll' in d['anime_video_url'] %} hidden {% endif %}>crunchyroll</span>
                                    <a href="{{d['anime_video_url']}}" role="button" target="_blank" 
                                    {% if 'none' == d['anime_video_url'] %} hidden {% endif %}><i class="fa fa-external-link"></i></a>
                                </div>
                            </div>
                            <div class="media-title" style="display: inline-block">
                                <span>{{d["anime_english_title"]}}</span>
                            </div>
                            <div id="media-genres" class="media-genres unselectable">
                                 {% set genrelist = d["anime_tags"].split('|') %} 
                                 {% for tag in genrelist %}
                                 <span class="genre">{{tag}}</span>
                                 {% endfor %}
                            </div>
                            <div style="display: inline-block">
                            <hr style='width: 10%; margin-right: 45% !important; margin-left: 45% !important; border: none; height: 3px; background-color: black;'>
                            </div>
                        </div>
                        <div class="row adjustable">
                            <div class="col-3 col-sm-3 col-md-3 col-lg-3 show-info">
                                <div class="container text-container">
                                <div class="row info-header">Query similarity:</div>
                                <div class="row"> 
                                    <span>{{d["score"]}} %</span>                                 
                                </div>
                                <div class="row info-header">Type:</div>
                                <div class="row"> 
                                    <span>{{d["anime_type"]}}</span>
                                </div>
                                <div class="row info-header">Rating:</div>
                                <div class="row">
                                    <span>{{d["anime_rating"]}}</span>
                                </div>
                                <div class="row info-header">Duration:</div>
                                <div class="row">
                                    <span>{{d["anime_duration"]}}</span>
                                </div>
                                <div class="row info-header">Number of episodes:</div>
                                <div class="row">
                                    <span>{{d["anime_number_of_episodes"]}}</span>
                                </div>
                            </div></div>
                            <div class="col-9 col-sm-9 col-md-9 col-lg-9 synopsis">
                                <div class="media-synopsis"><span>{{d['anime_synopsis']}}</span><br><br><br><br></div>
                            </div>
                        </div>
                        <div class="d-flex tag-info">
                             <div class="align-self-center"><span>Top Tags:</span></div>
                             <div class="align-self-start unselectable">
                                 {% set words = d["words"].split('|') %}
                                 {% for word in words %}
                                     <span onclick="addWord(this)" class="tag label label-info">{{word}}</span>
                                 {% endfor %}
                             </div>
                        </div>                      
                    </div>
                </div>
                <div class={% if loop.index == 1 %} "col-md-6 col-lg-3 order-lg-2 feature-segment" {% else %} "col-md-6 col-lg-3 feature-segment" {% endif %}>
                    <div class="container feature-segment-padded statistics-segment">
                    <div class="adjustable">
                        <div class="container" style="width: 100%">
                            <canvas class="data-visualization"
                            {% if loop.index == 1 %} id="{{d['chart_id_a']}}" {% else %} id="{{d['chart_id_b']}}" {% endif %} 
                            width="300" height="300" style="max-height: 100%, max-width: 100%"></canvas> 
                        </div>
                    </div>
                        <div id={% if loop.index == 1 %} "{{d['chart_legend_id_a']}}" {% else %} "{{d['chart_legend_id_b']}}" {% endif %} unselectable="on" class="chart-legends unselectable">
                                <label class="fancy-checkbox">
                                    <input type="checkbox" onclick="toggleLegendSuggestion(this)" checked/>
                                    <div class="legend-tag checked"><div class="legend-button"></div></div>
                                    <div class="legend-tag unchecked"><div class="legend-button"></div></div>
                                </label>
                                <label class="fancy-checkbox">
                                    <input type="checkbox" onclick="toggleLegendQuery(this)" checked/>
                                    <div class="legend-tag checked"><div class="legend-button"></div></div>
                                    <div class="legend-tag unchecked"><div class="legend-button"></div></div>
                                </label>
                        </div>
                    </div>
                </div>
                <div class={% if loop.index == 1 %} "col-md-6 col-lg-3 order-lg-1 feature-segment" {% else %} "col-md-6 col-lg-3 feature-segment" {% endif %}>
                    <div class="container feature-segment-padded">
                    <div class="container" style="width: 100%; height: 100%; padding:8px; display: flex; flex-direction: row">
                        <img src={{d["anime_image_url"]}} style="object-fit: contain; flex: 1">
                    </div>
                    </div>
                </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endfor %}
        {% endif %}
        {% if data %}
<!--            <br>
            <br>
            <br>
            <br>
            <br>
            <br> -->
            {% set title = data[0]['anime_english_title'] %}
            <div class="container-fluid feature-display" id="recommended-display">
                <div class="row">
                <div class="col-md-12 col-lg-6" style="height: 400px">
                    <div class="feature-anime-info">
                        <div class ="d-flex flex-column">
                            <div class="d-flex justify-content-between anime-info-bar">
                                <div class="align-self-start" id="plus-icon"><i onclick="addAnime('{{title}}')" class="fa fa-plus"></i></div>
                                <div class="feature-icon align-self-end">
                                    <img src="/static/images/yahoo_view_icon.png" id="yahoo-provider" 
                                    {% if not 'yahoo' in data[0]['anime_video_url'] %} hidden {% endif %}>
                                    <span style="margin-top: -4px; font-family:FuturaMedium; font-weight: bold; font-size:25; color:lawngreen" id="hulu-provider" 
                                    {% if not 'hulu' in data[0]['anime_video_url'] %} hidden {% endif %}>hulu</span>
                                    <img src="/static/images/Crunchyroll_24x24.png" id="crunchyroll-provider"
                                    {% if not 'crunchyroll' in data[0]['anime_video_url'] %} hidden {% endif %}>
                                    <span style="color: darkorange; font-size: 26px; line-height: 30px; font-weight: 600; margin-top: -3px; margin-left: 4px" id="crunchyroll-provider"
                                    {%if not 'crunchyroll' in data[0]['anime_video_url'] %} hidden {% endif %}>crunchyroll</span>
                                    <a href="{{data[0]['anime_video_url']}}" role="button" id="video-link" target="_blank" 
                                    {% if 'none' == data[0]['anime_video_url'] %} hidden {% endif %}><i class="fa fa-external-link"></i></a>
                                </div>
                            </div>
                            <div class="media-title" id="media-title">
                                <span>{{data[0]["anime_english_title"]}}</span>
                            </div>
                            <div class="media-genres unselectable">
                                 {% set genrelist = data[0]["anime_tags"].split('|') %} 
                                 {% for tag in genrelist %}
                                 <span class="genre">{{tag}}</span>
                                 {% endfor %}
                            </div>
                            <div style="display: inline-block">
                            <hr style='width: 10%; margin-right: 45% !important; margin-left: 45% !important; border: none; height: 3px; background-color: black;'>
                            </div>
                        </div>
                        <div class="row adjustable">
                            <div class="col-3 col-sm-3 col-md-3 col-lg-3 show-info">
                                <div class="container text-container">
                                    <div class="row info-header">Aniai Score:</div>
                                    <div class="row" id="similarity-score"> 
                                        <span>{{data[0]["score"]}}</span>
                                    </div>
                                    <div class="row info-header">Type:</div>
                                    <div class="row" id="media-type"> 
                                        <span>{{data[0]["anime_type"]}}</span>
                                    </div>
                                    <div class="row info-header">Rating:</div>
                                    <div class="row" id="media-rating">
                                        <span>{{data[0]["anime_rating"]}}</span>
                                    </div>
                                    <div class="row info-header">Duration:</div>
                                    <div class="row" id="media-duration">
                                        <span>{{data[0]["anime_duration"]}}</span>
                                    </div>
                                    <div class="row info-header">Number of episodes:</div>
                                    <div class="row" id="episode-count">
                                        <span>{{data[0]["anime_number_of_episodes"]}}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-9 col-sm-9 col-md-9 col-lg-9 synopsis">
                                <div class="media-synopsis" id="media-synopsis"><span>{{data[0]['anime_synopsis']}}</span><br><br><br><br></div>
                            </div>
                        </div>
                        <div class="d-flex tag-info">
                             <div class="align-self-center"><span>Top Tags:</span></div>
                             <div class="align-self-start unselectable" id="anime-tags">
                                 {% set words = data[0]["words"].split('|') %}
                                 {% for word in words %}
                                     <span onclick="addWord(this)" class="tag label label-info">{{word}}</span>
                                 {% endfor %}
                             </div>
                        </div>
                        <div class="d-flex justify-content-between anime-footer-bar"></div>  
                    </div>
                </div>
                <div class="col-md-6 col-lg-3 feature-segment">
                    <div class="container feature-segment-padded">
                    <div class="adjustable">
                        <div class="container" style="width: 100%">
                            <canvas class="data-visualization" id="vis" width="300" height="300" style="max-height: 100%, max-width: 100%"></canvas> 
                        </div>
                    </div>
                        <div id="chart-legends" unselectable="on" class="chart-legends unselectable">
                                <label class="fancy-checkbox">
                                    <input type="checkbox" onclick="toggleLegendSuggestion(this)" checked/>
                                    <div class="legend-tag checked"><div class="legend-button"></div></div>
                                    <div class="legend-tag unchecked"><div class="legend-button"></div></div>
                                </label>
                                <label class="fancy-checkbox">
                                    <input type="checkbox" onclick="toggleLegendQuery(this)" checked/>
                                    <div class="legend-tag checked"><div class="legend-button"></div></div>
                                    <div class="legend-tag unchecked"><div class="legend-button"></div></div>
                                </label>
                        </div>
                </div></div>
                <div class="col-md-6 col-lg-3 feature-segment">
                    <div class="container feature-segment-padded">
                    <div class="container" style="width: 100%; height: 100%; padding:8px; display: flex; flex-direction: row">
                        <img id="media-image" src={{data[0]["anime_image_url"]}} style="object-fit: contain; flex: 1">
                    </div>
                </div></div>
                </div>
            </div>
            <div class="owl-carousel owl-theme owl-loaded" id="suggestion-carousel">
                <div class="owl-stage-outer">
                    <div class="owl-stage">
                        {% for d in data%}
                        {% set image_url = d['anime_image_url'] %}
                        <div class="owl-item" style="height:100%">
                            <div class="view overlay" id="suggestionCard"
                                 data-index = "{{d['anime_index']}}" data-title = "{{d['anime_english_title']}}"
                                 data-type="{{d['anime_type']}}" data-duration="{{d['anime_duration']}}" data-image="{{d['anime_image_url']}}" 
                                 data-labels='{{ d["graph_words"]}}'
                                 data-values= "{{d['graph_value']}}"
                                 data-overallreview = '{{d["anime_review_overall_average"]}}' 
                                 data-storyreview = '{{d["anime_review_story_average"]}}'
                                 data-enjoyment = '{{d["anime_review_enjoyment_average"]}}'
                                 data-character = '{{d["anime_review_character_average"]}}'
                                 data-sound= '{{d["anime_review_sound_average"]}}'
                                 data-animation= '{{d["anime_review_animation_average"]}}'
                                 data-positive_words = '{{d["positive_words"]}}' 
                                 data-original_value = '{{d["original_value"]}}'
                                 data-episodes="{{d['anime_number_of_episodes']}}" data-tags="{{d['anime_tags']}}" data-synopsis="{{d['anime_synopsis']}}"  
                                 data-rating="{{d['anime_rating']}}" data-video="{{d['anime_video_url']}}" data-reviewernumber="{{d['anime_review_number']}}" 
                                 data-similarity="{{d['score']}}" data-ratingvalue="{{d['anime_rating_value']}}" data-raternumber="{{d['anime_rating_count']}}" 
                                 data-words="{{d['words']}}" style="height:100%">
                                <div {%if loop.index == 1%} class="well suggestion active" {% else %} class="well suggestion" {% endif %} style='height: 100%; background-position: center; background-size: cover; background-image: url("{{image_url}}")'></div>
                                <div class="mask flex-center rgba-stylish-strong">
                                    <div class="suggestion-text"> {{d["anime_english_title"]}} </div>
                                 </div>
                            </div>
                         </div>
                         {% endfor %}
                    </div>
                 </div>
           </div>
        {% endif %}
    </div>

<div class="footer">
   CS4300 Final Project: Aniai | Built by Cheyenne Biolsi (ckb59), Gary Gao (gg392), Arthur Chen (ac2266), Henry Levine (hal59), Kelley Zhang (kz53) | <a href="http://aniai.herokuapp.com/" target="_blank">Prototype1</a> | <a href="http://aniai2.herokuapp.com/" target="_blank">Prototype 2</a> |
</div>
    <!--    <script>
            $.getJSON("/static/data/anime_info.json", function(data) {
                 console.log(data);
                 document.getElementById('anime_info').innerHTML = data;
            });
    </script> -->

    <!--<script type="text/javascript" src="/static/mdb/js/popper.min.js"></script> -->
 
            <script>
                $("#suggestion-carousel").on('click', '.view', function() {
                    $('#recommended-display').css('opacity', 0);
                    setTimeout(function() {
                            $('#recommended-display').css('opacity', 1);
        	            var active = (document.querySelectorAll('.well.suggestion.active'));
                            active.forEach(function(well) {
                            well.classList.remove('active');
                        });
                    var children = $(this).find('.well.suggestion');
                    children.each(function(index) {
                        this.classList.add('active');
                    });
                    var anime_index = $(this).attr('data-index');
                    var anime_image_url = $(this).data("image");
                    var title = $(this).data("title");
                    var type = $(this).data("type");
                    var synopsis = $(this).data("synopsis");
                    var tags = $(this).data("tags");
                    var words = $(this).data("words");
                    var episode_count = $(this).data("episodes");
                    var duration = $(this).data("duration");
                    var rating = $(this).data("rating");
                    var overall = $(this).data("overallreview");  
                    var story = $(this).data("storyreview");  
                    var enjoyment = $(this).data("enjoyment");  
                    var character = $(this).data("character");  
                    var sound = $(this).data("sound");  
                    var animation = $(this).data("animation");
                    var similarity = $(this).data("similarity");
                    var reviewernumber = $(this).data("reviewernumber");
                    var raternumber = $(this).data("raternumber");
                    var ratingvalue = $(this).data("ratingvalue");
                    var thelabels = $(this).data("labels");
                    var thevalues = $(this).data("values");
                    var posiitive_words = $(this).data("positive_words");
                    var original_value = $(this).data("original_value");
                    $('#media-image').attr('src', anime_image_url);
                    $('#media-title span').text(title);
                    document.getElementById('plus-icon').innerHTML = "<i onclick='addAnime(" + '"' + title + '"' + ")' class='fa fa-plus'></i>";
                    $('#media-type span').text(type);
                    $('#media-rating span').text(rating);
                    $('#media-count span').text(episode_count);
                    $('#media-duration span').text(duration);
                    $('#media-synopsis span').text(synopsis);
                    $('#episode-count span').text(episode_count);
                    $('#similarity-score span').text(similarity);
                    $('#reviewer-number span').text("Number of Reviewers: " + reviewernumber);
                    $('#rater-number span').text("Number of Raters: " + raternumber);
                    $('#rating-value span').text("Rating: " + ratingvalue);
                    var tags = tags.split("|");
                    var str = "";
                    for (var tag in tags) {
                        str += '<span class="genre">' + tags[tag] + "</span>";
                    };
                    var words = words.split("|");
                    var wordStr = "";
                    for (var word in words) {
                        wordStr += '<span class="tag label label-info" onclick="addWord(this)">' + words[word] + "</span>";
                    };
                    $('#anime-tags').replaceWith(
                        '<div class="align-self-start unselectable" id="anime-tags">' + wordStr + '</div>'
                        );
                    $('#media-genres').replaceWith(
                        '<div class="media-genres unselectable" id="media-genres">' + str + '</div>'
                        );
                    var anime_video_url = $(this).data("video");
                    if (anime_video_url.includes('crunchyroll')) {
                        $('#video-link').attr("href", anime_video_url);
                        $('#video-link').attr("hidden", false);
                        $('#crunchyroll-provider-image').attr("hidden", false);
                        $('#crunchyroll-provider').attr("hidden", false);
                        $('#hulu-provider').attr("hidden", true);
                        $('#yahoo-provider').attr("hidden", true);
                    } else if (anime_video_url.includes('yahoo')) {
                        $('#video-link').attr("href", anime_video_url);
                        $('#video-link').attr("hidden", false);
                        $('#yahoo-provider').attr("hidden", false);
                        $('#hulu-provider').attr("hidden", true);
                        $('#crunchyroll-provider-image').attr("hidden", true);
                        $('#crunchyroll-provider').attr("hidden", true);
                    } else if (anime_video_url.includes('hulu')) {
                        $('#hulu-provider').attr("hidden", false);
                        $('#yahoo-provider').attr("hidden", true);
                        $('#video-link').attr("href", anime_video_url);
                        $('#video-link').attr("hidden", false);
                        $('#crunchyroll-provider-image').attr("hidden", true);
                        $('#crunchyroll-provider').attr("hidden", true);
                    } else {
                        $('#video-link').attr("href", anime_video_url);
                        $('#video-link').attr("hidden", true);
                        $('#crunchyroll-provider-image').attr("hidden", true);
                        $('#crunchyroll-provider').attr("hidden", true);
                        $('#hulu-provider').attr("hidden", true);
                        $('#yahoo-provider').attr("hidden", true);
                    };

                    anime_scores.destroy(); //delete charts
                    var thelabels2 = thelabels.split("|");
                    anime_scores = createChart("vis", "anime_scores", title, thelabels2, original_value, thevalues);
                    createLegend('chart-legends', anime_scores);
                    }.bind(this), 750);

                });
                  </script>
    <script>
        var functions = {
            showAllElements: function() {
                alert('show all called');
            },
            {% for d in similarityData %}
                {% for index in [0, 1] %}
                     {% if loop.index == 1 %}
                         {{d['function_name_a']}}: function() {
                              var labels = "{{d['graph_words']}}";
                              var labels_words = labels.split("|");
                              var title = "{{d['anime_english_title']}}";
                              var original_value = {{d['original_value']}};
                              var graph_value = {{d['graph_value']}};
                              var chartId = "{{d['chart_id_a']}}";
                              {{d['chart_name_a']}}.destroy()
                              {{d['chart_name_a']}} = createChart(chartId, "{{d['chart_name_a']}}", title, labels_words, original_value, graph_value);
                              var chart_legend_id="{{d['chart_legend_id_a']}}"
                              createLegend(chart_legend_id, {{d['chart_name_a']}});
                          },
                      {% else %}
                         {{d['function_name_b']}}: function() {
                              var labels = "{{d['graph_words']}}";
                              var labels_words = labels.split("|");
                              var title = "{{d['anime_english_title']}}";
                              var original_value = {{d['original_value']}};
                              var graph_value = {{d['graph_value']}};
                              var chartId = "{{d['chart_id_b']}}";
                              {{d['chart_name_b']}}.destroy()
                              {{d['chart_name_b']}} = createChart(chartId, "{{d['chart_name_b']}}", title, labels_words, original_value, graph_value);
                              var chart_legend_id="{{d['chart_legend_id_b']}}"
                              createLegend(chart_legend_id, {{d['chart_name_b']}});
                          },
                      {% endif %}
                {% endfor %}
            {% endfor %}
        };
		function toggle(source) {
		    var checkboxes = document.querySelectorAll('#sfwgenre');
		    for (var i = 0; i < checkboxes.length; i++) {
			if (checkboxes[i] != source) {
			    checkboxes[i].checked = source.checked;
			};
		    };
		    if ((document.querySelector('#sfw-button').checked)) {
			var checkboxes = document.querySelectorAll('#nsfwgenre');
			for (var i = 0; i < checkboxes.length; i++) {
			    checkboxes[i].checked = source.checked;
			}
		    };
		};
                function redirectHomepage() {
                    window.location.href = "/";
                };
		function clearnsfw(source) {
		    if (source.checked) {
			var genres = document.querySelectorAll('#nsfwgenre');
			for (var i = 0; i < genres.length; i++) {
			    genres[i].checked = true;
			};
			var ratings = document.querySelectorAll('#nsfwrating');
			for (var i = 0; i < ratings.length; i++) {
			    ratings[i].checked = true;
			};
		    };
		};

                function rescaleSuggestionChart(chartName) {
                    if ((chartName.data.datasets[0].hidden) && (chartName.data.datasets[1].hidden)) {
                        return;
                    } else if (!(chartName.data.datasets[0].hidden) && (chartName.data.datasets[1].hidden)) {
                        var maxVal = Math.max.apply(Math, chartName.data.datasets[0].data);
                    } else if ((chartName.data.datasets[0].hidden) && (!(chartName.data.datasets[1].hidden))) {
                        var maxVal = Math.max.apply(Math, chartName.data.datasets[1].data);
                    } else {
                        var maxVal = Math.max.apply(Math, chartName.data.datasets[0].data.concat(chartName.data.datasets[1].data));
                    }
                    maxVal = maxVal + 0.1;
                    chartName.options.scale.ticks.max = Math.min(1.0, (Math.floor(maxVal * 10))/10);
                };
		function toggleLegendQuery(source, chartName) {
		    chartName.data.datasets[0].hidden = !(source.checked);
                    rescaleSuggestionChart(chartName);
		    chartName.update();
		};
		function toggleLegendSuggestion(source, chartName) {
		    chartName.data.datasets[1].hidden = !(source.checked);
                    rescaleSuggestionChart(chartName);
		    chartName.update();
		};
		$(window).resize(function() {
                    {% if data %}
                      createLegend('chart-legends', anime_scores);
                      //  resizeInfo();
                      //  resizeTags();
                      //  resizeStatistics();
                        anime_scores.update();
                    {% endif %}
        });
       $('[data-toggle="collapse"]').click(function(e) {
            if($($(this).data('target')).hasClass('collapsing'))
            return false;
    });
    function drawSimilarityCharts() {
        {% for d in similarityData %}
            var labels = "{{d['graph_words']}}";
            var labels_words = labels.split("|");
            var title = "{{d['anime_english_title']}}";
            var original_value = {{d['original_value']}};
            var graph_value = {{d['graph_value']}};
            var chartId = "{{d['chart_id_a']}}";
            var canvas = ($(document.getElementById(chartId)));
            {{d['chart_name_a']}} = createChart(chartId, "{{d['chart_name_a']}}", title, labels_words, original_value, graph_value);
            canvas.data('function-name', "{{d['function_name_a']}}");
            canvas.data('chart', {{d['chart_name_a']}}); 
            canvas.data('title', title);
            canvas.data('label_words', labels_words);
            canvas.data('original_value', original_value);
            canvas.data('graph_value', graph_value);
            canvas.data('chartId', chartId);
            canvas.data('chart_name', "{{d['chart_name_a']}}");
            var chart_legend_id="{{d['chart_legend_id_a']}}"
            createLegend(chart_legend_id, {{d['chart_name_a']}});
            var chartId = "{{d['chart_id_b']}}";
            var canvas = ($(document.getElementById(chartId)));
            {{d['chart_name_b']}} = createChart(chartId, "{{d['chart_name_b']}}", title, labels_words, original_value, graph_value);
            canvas.data('chart', {{d['chart_name_b']}}); 
            canvas.data('label_words', labels_words);
            canvas.data('original_value', original_value);
            canvas.data('graph_value', graph_value);
            canvas.data('chartId', chartId);
            canvas.data('title', title);
            canvas.data('chart_name', "{{d['chart_name_b']}}");
            canvas.data('function-name', "{{d['function_name_b']}}");
            var chart_legend_id="{{d['chart_legend_id_b']}}"
            createLegend(chart_legend_id, {{d['chart_name_b']}});
        {% endfor %} 
    };

    function drawSimilarityCharts2() {
        return;
        {% for d in similarityData %}
            var labels = "{{d['graph_words']}}";
            var labels_words = labels.split("|");
            var title = "{{d['anime_english_title']}}";
            var original_value = {{d['original_value']}};
            var graph_value = {{d['graph_value']}};
            var chartId = "{{d['chart_id_a']}}";
            {{d['chart_name_a']}}.destroy()
            {{d['chart_name_a']}} = createChart(chartId, "{{d['chart_name_a']}}", title, labels_words, original_value, graph_value);
            var chart_legend_id="{{d['chart_legend_id_a']}}"
            createLegend(chart_legend_id, {{d['chart_name_a']}});
            var chartId = "{{d['chart_id_b']}}";
            {{d['chart_name_b']}}.destroy()
            {{d['chart_namass="btn btn-primary" data-toggle="collapse" href="#multiCollapseExample1" role="button" aria-expanded="false" aria-controls="multiCollapseExample1">Toggle first element</a>_b']}} = createChart(chartId, "{{d['chart_name_b']}}", title, labels_words, original_value, graph_value);
            var chart_legend_id="{{d['chart_legend_id_b']}}"
            createLegend(chart_legend_id, {{d['chart_name_b']}});
        {% endfor %} 
    };
    function drawInitialChart() {
        var labels = '{{data[0]["graph_words"]}}';
        var labels_words = labels.split("|");
        var title = "{{data[0]['anime_english_title']}}";
        var original_value = {{data[0]['original_value']}};
        var graph_value = {{data[0]['graph_value']}};
        anime_scores = createChart("vis", "anime_scores", title, labels_words, original_value, graph_value);
    };
    function styleCollapsable(collapsable, invert) {
        var rightInversion = $($(collapsable.find('.container-fluid.feature-display')).get(invert));
        var canvas = $(rightInversion).find('canvas');
        var fn = canvas.data('function-name');
        if (!(rightInversion.prop('hidden'))) {
            $(rightInversion.find('.chart-legends').get(0)).css('opacity', 1);
            $(rightInversion.find('.statistics-segment .adjustable').get(0)).css('opacity', 1);
            $(rightInversion.find('canvas').get(0)).css('opacity', 1);
            functions[fn]();
            return;
        };
        collapsable.css('opacity', 0);
        $('label-display').css('pointer-events', 'none');
        setTimeout(function() {
            $(collapsable.find('.container-fluid.feature-display').get(1 - invert)).prop('hidden', true);
            rightInversion.prop('hidden', false);
            collapsable.css('opacity', 1); 
            $(rightInversion.find('.chart-legends').get(0)).css('opacity', 1);
            $(rightInversion.find('.statistics-segment .adjustable').get(0)).css('opacity', 1);
            $(rightInversion.find('canvas').get(0)).css('opacity', 1);
            functions[fn]();
        }, 1000);
    };

    function fixInversions() {
        var shownDivs = document.querySelectorAll('.multi-collapse.collapse.show');
        shownDivs.forEach(function(collapsable, index) {
            styleCollapsable($(collapsable), 1 - ((shownDivs.length - index) % 2));
        });
 
    };
    {% for d in similarityData %}
        {% set collapse_id = "#" + d['collapse_id'] %}
        $("{{collapse_id}}").on('show.bs.collapse', function() {
            var children =  $(this).find('.container-fluid.feature-display');
            if ($($(children).get(0)).prop('hidden') && $($(children).get(1)).prop('hidden')) {
                $($(children).get(0)).prop('hidden', false);
            };
        });
        $("{{collapse_id}}").on('shown.bs.collapse', function() {
            $("{{collapse_id + ' .feature-row'}}").css('opacity', 1);
            fixInversions();
        });
        $("{{collapse_id}}").on('hidden.bs.collapse', function() {
            $("{{collapse_id + ' .chart-legends'}}").css('opacity', 0);
            $("{{collapse_id + ' .feature-row'}}").css('opacity', 0);
            fixInversions();
        });
    {% endfor %}
    </script>
    <script src="/static/owlcarousel/owl.carousel.min.js"></script>
</body>
</html>
